# Objective: Berlin Flirt Cartography #

Imaging riding a subway and spotting a person that you would like to meet but did not get the chance to talk to. Imaging a web site where such moments (called Augenblicke in the text below), can be publicly posted, hoping that the spotted person will read the post and get in touch with the poster.

Such a service is provided by the [Berliner Verkehrsbetriebe](http://www.bvg.de/) (BVG), which is the main public transportation operator in Berlin. The Augenblicke can be browsed [here](https://www.bvg.de/index.php/de/9460/name/Alle+Augenblicke.html).

This project aims to analyse the Augenblicke data in order to get an idea of the flirt life in Berlin. All the code to download the data from the web (scraper) and to perform the data analysis is provided. Have fun exploring big city life :-)

For using the provided data analysis code, you will need [GNU R](http://www.r-project.org/). If you don't like using R, please feel free to use the program of your choice to perform the data analysis. The scraper outputs a data file in [JSON](http://en.wikipedia.org/wiki/JSON) format, but can be set to write CSV output. All commonly used programs should be able to parse one of these formats.

All of the provided code is open source, so please feel free to edit and share it. If you start to work on the data, please share your finding and contribute your scripts to let other benefit from your efforts.

Data Sets
=========

## augenblicke.json ##

This file is generated by the scraper and contains the raw data downloaded from the web.
Please find a documentation of the generated fields below:

* **titel**: The title of the Augenblick post. 
* **zeit**: Timestamp when the Augenblick occurred, i.e., when the person was spotted during the train ride.
* **poster**: Nickname of the poster.
* **link**: URL of the specific Augenblick.
* **linie**: Public transportation line in which the Augenblick happened. Please find a detailed definition below.
* **text**: Augenblick text body.
* **verfasst**: Timestamp when the Augenblick was posted.

Example:
* title: Blonde student reading Shakespeare on an iPad
* zeit: 02.02.2013 18:00
* poster: gitster
* link: https://....
* linie: U2
* text: I entered U2 at Zoo station. We had eye contact when you were reading Shakespeare on your iPad. I'm 26/m and was wearing a blue shirt. I'd love to get in touch with you.
* verfasst: 02.02.2013 22:30

So in this example, *gitster* was riding subway line *U2* and spotted a blonde girl at 6 PM (18:00). He posted this Augenblick at 10:30 PM (22:30).

## augenblicke.csv ## 

An excerpt of the above json file is generated by json2csv.py and stored in augenblicke.csv.
Code to read this file into R is provided in R/readcsv.R.

The CSV file consists of three columns:
1. linie
2. zeit
3. verfasst

See augenblicke.json for a documentation of these fields.

## Date Formats ##

All dates are provided in the following format: *DD.MM.YYYY HH:MM*, where d, m, y, h, and m denote day, month, year, hour, and minute, respectively.

## Lines ##

There are a bunch of different transportation systems operated in Berlin.
* **[U-Bahn](http://www.bvg.de/index.php/en/17103/name/Underground.html)** (subway / underground): There are 9 subway lines U1 to U9.
* **[S-Bahn](http://www.bvg.de/index.php/en/17111/name/Urban+Rail+Trains.html)** (city trains): All city train lines begin with an S followed by a number.
* **[Regional trains](http://www.bvg.de/index.php/en/17112/name/Intercity+Railway+Services.html)**
* **[Bus lines](http://www.bvg.de/index.php/en/17105/name/Bus.html)**
* **[Night bus lines](http://www.bvg.de/index.php/en/17109/name/Night+Routes.html)** replacing the subway when they do not operate.
* **[Tram lines](http://www.bvg.de/index.php/en/17106/name/Tram.html)**:
* **[Fairies](http://www.bvg.de/index.php/en/17107/name/Ferry.html)**: 

[This](http://www.bvg.de/index.php/en/17100/name/Means+of+Transport+%26+Routes.html) page provides an overview over the public transportation system in Berlin.
You can find the network map [here](http://www.bvg.de/index.php/en/17099/name/Network+Map.html).

For a classification of line ids, see classifyLine() in R/tools.R.

Code
====

Please find a description of some code elements below. You can execute the entire processing by running *run.sh* in the main directory of the project.

Scraper
-------

The scraper will download the Augenblicke from the BVG web page and store the scraped items in augenblicke.json. To run the scraper, change into the *scraper* directory and run *run-scaper.sh*.

Results
=======

Do most of the moments occur at the weekends or during the week? The following stacked bar plot shows one bar per weekday. Each bar is split into the absolute share of Augenblicke that happened in each of the available transportation system (subway, train, bus, tram, ...)
![Weekdays](en-moments-transportation-weekdays.png)
The above figure shows that most Augenblicke happen in the subway (U-Bahn), followed by city trains (S-Bahn). It also shows that they happen during the week, and not at the weekends when the Berliner go clubbing. So if most of them happen during the week, do they happen on the way to (8 AM) and back from work (6PM)?

![Hours](en-moments-transportation-hours.png)
Peaks at 8 AM and 6 PM (18:00) show that this is indeed the case. Note that the 18:00 peak is much higher than the one in the morning, indicating that more Augenblicke happen after people are leaving work.

Are some of the above bars modulated by weekdays, e.g., do most of the Augenblicke spotted at night time happen at weekends?
![Hours vs. Days](en-moments-hours-vs-days.png)
Yes, the share of Augenblicke that can be associated with Friday / Saturday night clubbing is higher than for other days of the week during 1 and 4 in the morning.
